{"config":{"lang":["es"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Inicio","text":"<p>Bienvenidos a mi sitio. Soy Emi y desarrollo aplicaciones por afici\u00f3n. Aqu\u00ed encontrar\u00e1n notas sobre conceptos que me llamaron la atenci\u00f3n, diversos intereses. Si bien algunas cosas pueden parecer al azar, tiene alguna relaci\u00f3n con inform\u00e1tica, programaci\u00f3n, juegos y libros.</p>"},{"location":"blog/","title":"Blog","text":""},{"location":"blog/2025/06/19/hola-mundo/","title":"Hola Mundo!","text":"<p>Todo comienzo debe ser con un saludo a este mundo.</p> <p>He estado posponiendo este proyecto durante mucho tiempo. He probado diferentes herramientas mientras tanto, pero ninguna se ajustaba a mis necesidades hasta que encontr\u00e9 MKDocs, un proyecto fascinante para organizar documentaci\u00f3n y recopilar mis ideas en un blog. Su conjunto de herramientas incluye Python como backend, y Javascript, CSS, Typescript y HTML como frontend.</p> <p>Esta p\u00e1gina tendr\u00e1 enlaces a mis proyectos, que pronto compartir\u00e9 con la esperanza de que sean \u00fatiles, as\u00ed como otros intereses que surgir\u00e1n con el tiempo.</p> <p>Gracias por leer.</p>"},{"location":"linux/","title":"Descripci\u00f3n","text":"<p>Ac\u00e1 se pueden encontrar notas sobre mi administraci\u00f3n de sistema y otras actividades relacionadas con servicios y aplicaciones. Todas las notas est\u00e1n basas en Arch Linux como sistema de escritorio a menos que se indique lo contrario.</p>"},{"location":"linux/nut-monitor/","title":"Nut-Monitor","text":""},{"location":"linux/nut-monitor/#introduccion","title":"Introducci\u00f3n","text":"<p>Estaba realizando mantenimiento de sistema y descubr\u00ed algunos inconvenientes con mi configuraci\u00f3n actual, de manera que decid\u00ed documentar el proceso y compartirlo.</p> <p>Utilizo la UPS CTB-1200. Est\u00e1 conectada por cable usb. luego de seguir las instrucciones de la wiki y establecer una configuraci\u00f3n b\u00e1sica; los siguientes archivos necesitaron modificaciones para que la instalaci\u00f3n sea efectiva.</p>"},{"location":"linux/nut-monitor/#configuracion","title":"Configuraci\u00f3n","text":""},{"location":"linux/nut-monitor/#configuracion-del-driver","title":"Configuraci\u00f3n del driver","text":"<p>No todos los modelos son compatibles. Tuve la suerte de encontrar mi dispositivo en la p\u00e1gina de Network UPS Tools, la cual provee los par\u00e1metros de configuraci\u00f3n necesarios.</p> <p>Existen varios archivos que deben modificarse de acuerdo al modelo de UPS del usuario, los cuales residen en la carpeta <code>/etc/nut</code>.</p> <pre><code>/etc/nut\n\u251c\u2500\u2500 hosts.conf\n\u251c\u2500\u2500 nut.conf # Habilitar el monitor\n\u251c\u2500\u2500 ups.conf # Configuraci\u00f3n del driver \n\u251c\u2500\u2500 upsd.conf\n\u251c\u2500\u2500 upsd.users # Requerido para enviar comandos al demonio\n\u251c\u2500\u2500 upsmon.conf # Configuraci\u00f3n del demonio\n\u251c\u2500\u2500 upssched.conf # Temporizador y planificaci\u00f3n de comandos\n\u251c\u2500\u2500 upssched-cmd # Script personalizado del usuario\n\u251c\u2500\u2500 upsset.conf\n\u251c\u2500\u2500 upsstats.html\n\u2514\u2500\u2500 upsstats-single.html\n</code></pre>"},{"location":"linux/nut-monitor/#nutconf","title":"nut.conf","text":"<p>En este archivo se debe cambiar la siguiente l\u00ednea de 'none' a 'standalone' para habilitar el monitor.</p> <pre><code># Valores y comentarios por defecto omitidos\nMODE=standalone \n</code></pre>"},{"location":"linux/nut-monitor/#upsconf","title":"ups.conf","text":"<p>En este archivo se encuentra la configuraci\u00f3n del driver. La compatibilidad de los par\u00e1metros depender\u00e1n del driver. A continuaci\u00f3n se muestran valores de prop\u00f3sito general que deber\u00edan funcionar para la mayor\u00eda de los drivers.</p> <pre><code># Valores y comentarios por defecto omitidos, \n# agregar la configuraci\u00f3n del driver deseado\n# al final.\n[ctb-1200]\n    driver = blazer_usb\n    port = auto\n    offdelay = 20\n    ondelay = 30\n    ignorelb\n    override.battery.charge.low = 20\n    override.battery.charge.warning = 40\n</code></pre>"},{"location":"linux/nut-monitor/#upsusers","title":"ups.users","text":"<p>En este archivo se encuentran las configuraciones de usuario. Es requerido para enviar comandos al demonio.</p> <pre><code>[dnloop]\n     password = 1212\n     upsmon master\n     actions = SET\n     instcmds = ALL\n</code></pre>"},{"location":"linux/nut-monitor/#upsmonconf","title":"upsmon.conf","text":"<p>En este archivo se encuentra la configuraci\u00f3n del demonio. Proporciona una interfaz para enviar comandos al dispositivo.</p> <pre><code># Valores y comentarios por defecto omitidos\nSHUTDOWNCMD \"/sbin/shutdown -h +0\"\nNOTIFYCMD /usr/sbin/upssched\nNOTIFYFLAG ONLINE      SYSLOG+WALL+EXEC\nNOTIFYFLAG ONBATT      SYSLOG+WALL+EXEC\nNOTIFYFLAG LOWBATT     SYSLOG+WALL+EXEC\nNOTIFYFLAG REPLBATT    SYSLOG+WALL+EXEC\nMONITOR ctb-1200@localhost 1 dnloop 1212 master # misma credenciales que ups.users\n</code></pre>"},{"location":"linux/nut-monitor/#upsschedconf","title":"upssched.conf","text":"<p>En este archivo se encuentra la configuraci\u00f3n del temporizador y planificaci\u00f3n de comandos. Aqu\u00ed se puede ajustar el tiempo de espera hasta la re conexi\u00f3n o apag\u00f3n. Es recomendable no esperar demasiado en una interrupci\u00f3n de electricidad debido a la edad de la bater\u00eda, es mejor apagar r\u00e1pido el sistema que esperar para apagar y la bater\u00eda no mantenga la carga suficiente para terminar el sistema.</p> <pre><code># Valores y comentarios por defecto omitidos\nCMDSCRIPT /etc/nut/upssched-cmd\n\nPIPEFN /var/lib/nut/upssched/upssched.pipe\nLOCKFN /var/lib/nut/upssched/upssched.lock\n\nAT ONBATT * START-TIMER shutdown_onbatt 40 # valor en segundos\nAT ONBATT * EXECUTE info_onbatt\n\nAT ONLINE * CANCEL-TIMER shutdown_onbatt\nAT ONLINE * EXECUTE ups-back-on-power\n\nAT LOWBATT * EXECUTE shutdown_lowbatt\n\nAT REPLBATT * EXECUTE replace_batt\n</code></pre>"},{"location":"linux/nut-monitor/#script-personalizado","title":"Script personalizado","text":"<p>Este script es donde se almacenan los comandos personalizados. Se llama a trav\u00e9s de <code>upssched.conf</code>. Se puede modificar para ejecutar el manejo apropiado de los servicios y notificar los registros de eventos. Solo estoy registrando y forzando un apagado por ahora.</p> <p>/var/lib/nut/upssched/</p> <p>Los archivos de pipe y lock son necesarios para que el demonio funcione e informe al registrador de mensajes el estado de los comandos ejecutados.</p> <pre><code>touch upssched.pipe\ntouch upssched.lock\nchown nut:nut upssched.*\nchmod 770 upssched.*\n</code></pre> <p>upssched-cmd</p> <p>Este script es donde se almacenan los comandos personalizados. Se llama a trav\u00e9s de <code>upssched.conf</code>. Se puede modificar para ejecutar el manejo apropiado de los servicios y notificar los registros de eventos. Solo estoy registrando y forzando un apagado por ahora.</p> <pre><code>#! /bin/sh\ncase $1 in\n    shutdown_onbatt)\n        logger -t upsmon[upssched] \"shutdown_onbatt): Triggering shutdown after being on battery\"\n        /sbin/shutdown -h +0\n        ;;\n\n    shutdown_lowbatt)\n        logger -t upsmon[upssched] \"shutdown_lowbatt): Triggering shutdown when battery.charge.low is under 50%\"\n        /sbin/shutdown -h +0\n        ;;\n\n    info_onbatt)\n        logger -t upsmon[upssched] \"info_onbatt): Now on battery\"\n        ;;\n\n    ups-back-on-power)\n        logger -t upsmon[upssched] \"ups-back-on-power): UPS back on power\"\n        ;;\n\n    replace_batt)\n        message=\"Quick self-test indicates battery requires replacement\"\n        logger -t upsmon[upssched] \"replace_batt): $message\"\n        ;;\n\n    *)\n        logger -t upsmon[upssched] \"*) = Unrecognized command: $1\"\n        ;;\nesac\n</code></pre>"},{"location":"linux/nut-monitor/#systemd-targets","title":"Systemd Targets","text":"<p>Estos son los objetivos de systemd extra\u00eddos de la wiki de Arch, deber\u00edan estar presentes despu\u00e9s de seguir el gu\u00eda.</p> <pre><code>\u256d\u2500 /etc/systemd/system/\n\nnut-driver@ctb-1200.service.d\n\u251c\u2500\u2500 nut-driver-enumerator-generated-checksum.conf\n\u251c\u2500\u2500 nut-driver-enumerator-generated.conf\n\u251c\u2500\u2500 nut-driver-enumerator-generated-devicename.conf\n\u2514\u2500\u2500 nut-driver-enumerator-generated-doclink.conf\nnut-driver@.service.d\n\u2514\u2500\u2500 nut-driver-enumerator-generated-checksum.conf\nnut-driver.target.wants\n\u2514\u2500\u2500 nut-driver@ctb-1200.service -&gt; /usr/lib/systemd/system/nut-driver@.service\nnut.target.wants\n\u251c\u2500\u2500 nut-driver-enumerator.service -&gt; /usr/lib/systemd/system/nut-driver-enumerator.service\n\u251c\u2500\u2500 nut-driver.target -&gt; /usr/lib/systemd/system/nut-driver.target\n\u2514\u2500\u2500 nut-server.service -&gt; /usr/lib/systemd/system/nut-server.service\n</code></pre>"},{"location":"linux/nut-monitor/#resumen-de-servicios","title":"Resumen de servicios","text":"<ul> <li>nut-server.service</li> <li>nut-monitor.service</li> <li>nut-driver-enumerator.service</li> </ul>"},{"location":"linux/nut-monitor/#luego-de-la-instalacion","title":"Luego de la instalaci\u00f3n","text":"<p>Se puede verificar una instalaci\u00f3n correcta con: </p> <pre><code>sudo upsd\n</code></pre> <p>Deber\u00eda mostrar algo similar a:</p> <pre><code>Network UPS Tools upsd 2.8.3 release\nnot listening on ::1 port 3493\nnot listening on 127.0.0.1 port 3493\nno listening interface available\n</code></pre> <p>Un servidor configurado de forma apropiada deber\u00eda mostrar entradas similares, la m\u00e1s reciente es cuando la UPS se desconecta de la pared. Las siguientes entradas, <code>info_onbatt</code> y <code>ups-back-on-power</code> provienen del script personalizado.</p> <p><code>sudo journalctl -f</code> output</p> <pre><code>Broadcast message from nut@lyra (somewhere) (Mon Jun 23 17:36:42 2025):        \n\nUPS ctb-1200@localhost on battery                                              \n\n\nBroadcast message from nut@lyra (somewhere) (Mon Jun 23 17:36:42 2025):        \n\nUPS ctb-1200@localhost on battery                                              \n\nJun 23 17:36:42 lyra nut-monitor[8567]: UPS ctb-1200@localhost on battery\nJun 23 17:36:43 lyra upsmon[9256]: info_onbatt): Now on battery\n...\n[OMITIDO]\n...                                                                              \nBroadcast message from nut@lyra (somewhere) (Mon Jun 23 17:36:52 2025):        \n\nUPS ctb-1200@localhost on line power                                           \n\n\nBroadcast message from nut@lyra (somewhere) (Mon Jun 23 17:36:52 2025):        \n\nUPS ctb-1200@localhost on line power                                           \n\nJun 23 17:36:52 lyra nut-monitor[8567]: UPS ctb-1200@localhost on line power\nJun 23 17:36:52 lyra upsmon[9395]: ups-back-on-power): UPS back on power\n</code></pre> <p><code>sudo journalctl -rxb | grep upsd</code> output</p> <pre><code>Jun 23 17:25:17 lyra upsd[8540]: User dnloop@::1 logged into UPS [ctb-1200]\nJun 23 17:25:13 lyra upsd[8540]: upsnotify: logged the systemd watchdog situation once, will not spam more about it\nJun 23 17:25:13 lyra upsd[8540]: upsnotify: failed to notify about state NOTIFY_STATE_READY_WITH_PID: no notification tech defined, will not spam more about it\nJun 23 17:25:13 lyra upsd[8540]: upsnotify: notify about state NOTIFY_STATE_READY_WITH_PID with libsystemd: was requested, but not running as a service unit now, will not spam more about it\nJun 23 17:25:13 lyra upsd[8540]: Running as foreground process, not saving a PID file\nJun 23 17:25:13 lyra upsd[8540]: Found 1 UPS defined in ups.conf\nJun 23 17:25:13 lyra upsd[8540]: Connected to UPS [ctb-1200]: blazer_usb-ctb-1200\nJun 23 17:25:13 lyra upsd[8540]: listening on 127.0.0.1 port 3493\nJun 23 17:25:13 lyra upsd[8540]: listening on ::1 port 3493\nJun 23 17:25:13 lyra nut-server[8540]: Network UPS Tools upsd 2.8.3 release\n</code></pre> <p><code>sudo journalctl -rxb | grep nut-server</code> output</p> <pre><code>Jun 23 17:25:17 lyra nut-server[8540]: User dnloop@::1 logged into UPS [ctb-1200]\nJun 23 17:25:13 lyra nut-server[8540]: upsnotify: logged the systemd watchdog situation once, will not spam more about it\nJun 23 17:25:13 lyra nut-server[8540]: upsnotify: failed to notify about state NOTIFY_STATE_READY_WITH_PID: no notification tech defined, will not spam more about it\nJun 23 17:25:13 lyra nut-server[8540]: upsnotify: notify about state NOTIFY_STATE_READY_WITH_PID with libsystemd: was requested, but not running as a service unit now, will not spam more about it\nJun 23 17:25:13 lyra nut-server[8540]: Running as foreground process, not saving a PID file\nJun 23 17:25:13 lyra nut-server[8540]: Found 1 UPS defined in ups.conf\nJun 23 17:25:13 lyra nut-server[8540]: Connected to UPS [ctb-1200]: blazer_usb-ctb-1200\nJun 23 17:25:13 lyra nut-server[8540]: listening on 127.0.0.1 port 3493       \nJun 23 17:25:13 lyra nut-server[8540]: listening on ::1 port 3493  \n</code></pre> <p>Para obtener informaci\u00f3n sobre la UPS, ejecutar <code>upsc &lt;upsname&gt;</code></p> <pre><code>upsc ctb-1200\nbattery.charge: 100\nbattery.charge.low: 20\nbattery.charge.warning: 40\nbattery.voltage: 27.10\nbattery.voltage.high: 26.00\nbattery.voltage.low: 20.80\nbattery.voltage.nominal: 24.0\ndevice.type: ups\ndriver.debug: 0\ndriver.flag.allow_killpower: 0\ndriver.flag.ignorelb: enabled\ndriver.name: blazer_usb\ndriver.parameter.offdelay: 20\ndriver.parameter.ondelay: 30\ndriver.parameter.override.battery.charge.low: 20\ndriver.parameter.override.battery.charge.warning: 40\ndriver.parameter.pollinterval: 2\ndriver.parameter.port: auto\ndriver.parameter.synchronous: auto\ndriver.state: quiet\ndriver.version: 2.8.3\ndriver.version.internal: 0.21\ndriver.version.usb: libusb-1.0.29 (API: 0x0100010A)\ninput.current.nominal: 5.0\ninput.frequency: 50.0\ninput.frequency.nominal: 50\ninput.voltage: 224.4\ninput.voltage.fault: 224.4\ninput.voltage.nominal: 220\noutput.voltage: 226.5\nups.beeper.status: enabled\nups.delay.shutdown: 18\nups.delay.start: 1800\nups.load: 5\nups.productid: 5161\nups.status: OL\nups.type: offline / line interactive\nups.vendorid: 0665\n</code></pre>"},{"location":"linux/nut-monitor/#referencias","title":"Referencias","text":"<ul> <li>Network UPS Tools</li> <li>NUT &amp; UPS, howto shut down client after 2 min on battery?</li> <li>nut \u2013 testing the shutdown mechanism</li> <li>6.\u00a0Configuration notes</li> </ul>"},{"location":"blog/archive/2025/","title":"2025","text":""},{"location":"blog/category/hola_mundo/","title":"Hola_Mundo","text":""}]}